@using System.Globalization
@using inzibackend
@using inzibackend.Web.Areas.App.Models.Common.Modals
@using inzibackend.Web.Areas.App.Models.RecordCategories
@using inzibackend.Web.Areas.App.Models.Purchase
@using Abp.Extensions
@await Html.PartialAsync("~/Areas/App/Views/Common/Modals/_ModalHeader.cshtml", new ModalHeaderViewModel(L("PaymentRequired")))

@{
    var isZeroAmount = Model.AmountDue <= 0;
    var actionButtonClass = isZeroAmount ? "btn-success" : "btn-primary";
    var actionButtonIcon = isZeroAmount ? "fa-check" : "fa-plus";
    var actionButtonText = isZeroAmount ? L("Register") : L("MakePurchase");
}

@model BuyServicesViewModel
@if(Model.UseSandboxPayment==true)
{
  <script type="text/javascript"
        src="https://jstest.authorize.net/v1/Accept.js"
        charset="utf-8">
</script>  
}
else
{
   <script type="text/javascript"
        src="https://js.authorize.net/v1/Accept.js"
        charset="utf-8">
</script> 
}



<div class="modal-body">
    <div id="PurchaseTab">
        <form name="UserPurchaseForm" role="form" novalidate class="form-validation">
@*            <div class="my-3">
                <label class="form-label" for="SurpathService_Name">@L("Name")</label>
                <input class="form-control" id="SurpathService_Name" value="@Model.SurpathService.Name" type="text" name="name" required />
            </div>*@
            <input type="hidden" name="dataValue" id="dataValue" />
            <input type="hidden" name="dataDescriptor" id="dataDescriptor" />
            <input type="hidden" name="transactionId" id="transactionId" />
            <input type="hidden" name="authCode" id="authCode" />
            <input type="hidden" name="differentBillingAddress" id="differentBillingAddress" />
            <div id="serviceListSection" class="my-3 @(isZeroAmount ? "d-none" : string.Empty)">
                <label class="form-label" for="">@L("Services")</label><br />
                @{
                    var _itemid = 0;
                    var culture = new System.Globalization.CultureInfo("en-US");
                }
                @foreach (var _s in Model.TenantSurpathServices)
                {
                    _itemid++;
                    var _idx = Model.TenantSurpathServices.IndexOf(_s);
                    var serviceDto = Model.TenantSurpathServices[_idx];
                    var displayPrice = String.Format(culture, "{0:C}", serviceDto.Price);
                    var amountDueDisplay = String.Format(culture, "{0:C}", serviceDto.AmountDue);
                    var priceLabel = serviceDto.IsInvoiced
                        ? string.Format("{0} ({1})", displayPrice, L("IsInvoiced"))
                        : amountDueDisplay;

                    if (!isZeroAmount)
                    {
                        <span>@serviceDto.Name - @serviceDto.Description - @priceLabel</span>
                        <br />
                    }

                    <input type="hidden" id="SurpathServicesIds_@_idx" name="SurpathServicesIds[]" value="@_s.SurpathServiceId" />
                    <input type="hidden" id="TenantSurpathServiceIds_@_idx" name="TenantSurpathServiceIds[]" value="@_s.Id" />

                    <input class="sp-lineitem sp-lineitem-itemid" type="hidden" value="@_itemid" />
                    <input class="sp-lineitem sp-lineitem-name" type="hidden" value="@serviceDto.Name" />
                    <input class="sp-lineitem sp-lineitem-description" type="hidden" value="@serviceDto.Description" />
                    <input class="sp-lineitem sp-lineitem-quantity" type="hidden" value="1" />
                    <input class="sp-lineitem sp-lineitem-unitprice" type="hidden" value="@String.Format(culture,"{0:C}", serviceDto.AmountDue)" />

                }
            </div>
           
            <div id="amountDueSection" class="my-3 @(isZeroAmount ? "d-none" : string.Empty)">
                <label class="form-label" for="AmountDue">@L("AmountDue")</label>
                <input type="hidden" name="amount" id="amount" placeholder="" value="@Model.AmountDue" />
                <span class="bolder">@String.Format(new System.Globalization.CultureInfo("en-US"),"{0:C}", Model.AmountDue)</span>
            </div>
            <div id="noPaymentRequiredMessage" class="alert alert-success @(isZeroAmount ? "" : "d-none")">
                @("Your institution is covering these services. Click Register to complete your registration.")
            </div>
            <div id="paymentDetailsSection" class="@(isZeroAmount ? "d-none" : "")">
                <div id="differentBillingSection" class="form-check form-check-custom form-check-solid my-3">
                    <input type="checkbox" id="differentBillingAddressChk" name="differentBillingAddressChk" value="true" class="form-check-input">
                    <label class="form-check-label" for="differentBillingAddressChk">@L("DifferentBillingInfo")</label>
                </div>

                <div id="billingAddressWrapper" class="d-none">
                    <div class="my-3">
                        <label class="form-label" for="firstNameOnCard">@L("FirstNameOnCard")</label>
                        <input type="text" name="firstNameOnCard" id="firstNameOnCard" placeholder="First name on card" class="form-control card-name-input" />
                    </div>
                    <div class="my-3">
                        <label class="form-label" for="lastNameOnCard">@L("LastNameOnCard")</label>
                        <input type="text" name="lastNameOnCard" id="lastNameOnCard" placeholder="Last name on card" class="form-control card-name-input" />
                    </div>
                    <div class="my-3">
                        <label class="form-label" for="billingAddress">@L("Address")</label>
                        <input type="text" name="billingAddress" id="billingAddress" placeholder="" value="" class="form-control" />
                    </div>
                    <div class="my-3">
                        <label class="form-label" for="billingCity">@L("City")</label>
                        <input type="text" name="billingCity" id="billingCity" placeholder="" value="" class="form-control" />
                    </div>
                    <div class="my-3">
                        <label class="form-label" for="billingState">@L("State")</label>
                        <input type="text" name="billingState" id="billingState" placeholder="" value="" maxlength="2" class="form-control" />
                    </div>

                </div>
                <div class="my-3">
                    <label class="form-label" for="cardNameOnCard">@L("CardNameOnCard")</label>
                    <input type="text" name="cardNameOnCard" id="cardNameOnCard" placeholder="Name on card" class="form-control" disabled />
                </div>
                
                <div class="my-3">
                    <label class="form-label" for="billingZipCode">@L("CardZipCode")</label>
                    <input type="text" name="billingZipCode" id="billingZipCode" placeholder="Card Zip Code" class="form-control" />
                </div>
                <div class="my-3">
                    <label class="form-label" for="cardnumber">@L("CreditCard")</label>
                    <input type="number" name="cardNumber" id="cardNumber" placeholder="cardNumber" class="form-control surpath-nosubmit" pattern="[0-9]{13,19}" />
                </div>
                <div class="my-3">
                    <label class="form-label" for="expMonth">@L("expMonth")</label>
                    <input type="number" name="expMonth" id="expMonth" class="form-control surpath-nosubmit" pattern="[0-9]{2}"/>
                </div>
                <div class="my-3">
                    <label class="form-label" for="expYear">@L("expYear")</label>
                    <input type="number" name="expYear" id="expYear" class="form-control surpath-nosubmit" pattern="[0-9]{4}"/>
                </div>
                <div class="my-3">
                    <label class="form-label" for="cardCode">@L("cardCode")</label>
                    <input type="number" name="cardCode" id="cardCode" placeholder="CVV" class="form-control surpath-nosubmit" />
                </div>
            </div>
            <a id="buttonMakePurchase" class="btn @actionButtonClass blue">
                <i class="fa @actionButtonIcon"></i>
                <span class="action-text">@actionButtonText</span>
            </a>
            @*<button type="button" id="buttonMakePurchase" onclick="sendPaymentDataToAnet()">@L("MakePurchase")</button>*@
        </form>
    </div>
</div>

@await Html.PartialAsync("~/Areas/App/Views/Common/Modals/_ModalFooterWithLogout.cshtml")
