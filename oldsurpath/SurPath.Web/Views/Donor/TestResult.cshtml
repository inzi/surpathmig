@model IEnumerable<SurPathWeb.Models.TestResultDataModel>
@using GridMvc.Html
@{
    ViewBag.Title = "TestResult";
    Layout = "~/Views/Shared/_DonorLayout.cshtml";
}

@section PageScript
{
    <script src='@Url.Content("~/Scripts/popup.js")'></script>
    <link href='@Url.Content("~/Content/Gridmvc.css")' rel="stylesheet" type="text/css" />

    <script type="text/javascript">
        $(function () {
            if ("@ViewBag.ServerErr" != "") {
                $("#divServerErr").show().find("div").html("@ViewBag.ServerErr");
            }

            var element = document.getElementById('tab');

            if (element.offsetHeight > "500") {
                $("#tab").css({ "max-height": "500px", "overflow-y": "scroll" });
            }
            else {
                $("#tab").css({ "max-height": "500px", "overflow-y": "hidden" });
            }
        });
    </script>
}

@{using (Html.BeginForm())
{
    if (Session["isPaymentStatus"].ToString() == "No")
    {
        <div class="mainbox col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
            <div class="alert alert-danger" role="alert">
                <i class="fa fa-exclamation-triangle fa-1x"></i> You have pending payment <a href="@Url.Action("PaymentSelection", "Donor")">Click here to Pay </a>
            </div>
        </div>
        <div class="row top-buffer"></div>
    }
    <div class="container">
        <div style="display:none" class="alert alert-danger" role="alert" id="divServerErr">
            <i class="fa fa-exclamation-triangle fa-1x"></i> @ViewBag.ServerErr
        </div>
        <div class="row">
            <div class="col-md-12">
                <h3> Test Results </h3>
                <hr />
            </div>
        </div>
        <div class="row top-buffer"></div>
        <!-- table starts here -->
        <div class="table-responsive table-striped table-bordered" id="tab" >
            @Html.Grid(Model).Columns(columns =>
       {
           columns.Add(m => m.FirstName).Sortable(true).Titled("First Name");
           columns.Add(m => m.LastName).Sortable(true).Titled("Last Name");
           columns.Add(m => m.SSN).Titled("SSN");
           columns.Add(m => m.DOB).Titled("DOB");
           columns.Add(m => m.TestStatus).Titled("Status");
           columns.Add(m => m.TestDate).Sortable(true).Titled("Tested Date");
           columns.Add(m => m.TestOverallResult).Sortable(true).Titled("Final Result");
           columns.Add()
                .Encoded(false)
                .Sanitized(false)
                .SetWidth(80)
                .RenderValueAs(m => m.DownloadLink)
               //.RenderValueAs(m => Html.ActionLink("Download", "_TestResultView", "Donor", new { firstname = m.FirstName, lastname = m.LastName }, new { @target = "_blank" }))
                .Titled("Download Actions");
                columns.Add()
               .Encoded(false)
               .Sanitized(false)
           //  .SetWidth(20)
               .RenderValueAs(m => m.MRODownloadLink);
               //.RenderValueAs(m => Html.ActionLink("Download", "_TestResultView", "Donor", new { firstname = m.FirstName, lastname = m.LastName }, new { @target = "_blank" }))
               //.Titled("MROAction");

       }).WithPaging(20)
        </div>
        <!--- Table ends here -->
        <div class="row top-buffer"></div>
        <div class="row top-buffer"></div>
        <div class="row top-buffer"></div>
        <div class="row top-buffer"></div>
    </div>
}
}
