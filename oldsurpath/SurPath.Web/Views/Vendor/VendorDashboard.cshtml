@model IEnumerable<SurPathWeb.Models.TestResultDataModel>
@using GridMvc.Html
@{
    ViewBag.Title = "Search";
    Layout = "~/Views/Shared/_VendorLayout.cshtml";
    int year = 2014;
}
@section PageScript
{
    <link href='@Url.Content("~/Content/Gridmvc.css")' rel="stylesheet" type="text/css" />
    <script type="text/javascript">

        $(function () {

            if ("@ViewBag.SuccessMsg" != "") {
                $("#divSuccessMsg").show().find("div").html("@ViewBag.SuccessMsg");

                if (navigator.userAgent.search("Safari") >= 0 && navigator.userAgent.search("Chrome") < 0) {
                    setTimeout("$('#divSuccessMsg').hide();", 6000);
                }
                else {
                    $("#divSuccessMsg").fadeOut(6000);
                }
            }

            var element = document.getElementById('tab');

            if (element.offsetHeight > "500") {
                $("#tab").css({ "max-height": "500px", "overflow-y": "scroll" });
            }
            else {
                $("#tab").css({ "max-height": "500px", "overflow-y": "hidden" });
            }

            $("#liDashboard").addClass("active");
            $("#liDonorInfo").removeClass("active");
            $("#liTestInfo").removeClass("active");
            $("#liVendorSearch").removeClass("active");

            $('#optToday').click(function () {
                $("#optSelectDate").attr("checked", false);
                $("#hidSearchKey").val("1");
                $("#validateForm").hide();
                $("#Error-date").hide();
            });

            $('#optSelectDate').click(function () {
                $("#optToday").attr("checked", false);
                $("#hidSearchKey").val("2");
                $("#validateForm").hide();
                $("#Error-date").hide();
            });

            $("#btnSearch").click(function () {

                $("#validateForm").hide();
                $("#Error-date").hide();

                var status = true;
                var searchKey = $("#hidSearchKey").val();
                $('#hidSearchKey').val(searchKey);

                $('#hidSearchValue').val(searchValue);
                if (searchKey == '0') {
                    $("#validateForm").show();
                    status = false;
                }
                else if (searchKey == 2) {

                    if ((($("#Date").val() == "") || ($("#Month").val() == "") || ($("#Year").val() == ""))) {
                        $("#dropdownDOB").siblings("#Error-date").show();
                        return false;
                    }
                    else {
                        var searchValue = $("#Year").val() + "-" + $("#Month").val() + "-" + $("#Date").val();
                        $("#dropdownDOB").show();
                        $('#hidSearchValue').val(searchValue);
                        status = true;
                    }
                }

                return status;
            });


        });
    </script>

}
@{using (Html.BeginForm())
{
    <div class="container">
        <div style="display:none" class="alert alert-danger" role="alert" id="divServerErr">
            <i class="fa fa-exclamation-triangle fa-1x"></i> @ViewBag.ServerErr
        </div>
        <div style="display:none" class="alert alert-success" role="alert" id="divSuccessMsg">
            <i class="fa fa-check fa-1x"></i> @ViewBag.SuccessMsg
        </div>
        @*<div class="row">
                <div class="col-md-3 pull-right">
                    <h4> @*December 26, 2014*</h4>
                </div>
                <div class="col-md-4 pull-left">
                    <h3> Scheduled Donors </h3>
                    <hr>
                </div>
            </div>

            <div class="row">
                <div class="col-md-2">
                    <label class="radio-inline">
                        <input type="radio" class="form-horizontal" value="optToday" id="optToday" >
                        Today
                    </label>
                </div>
                <div class="col-md-2" style="margin-left: -100px;">
                    <label class="radio-inline" style="padding-left: 80px;">
                        <input type="radio" class="form-horizontal" value="optSelectDate" id="optSelectDate">
                        Select Date
                    </label>

                </div>

                <div class="col-md-4">
                    <div class="row" id="dropdownDOB">
                        <div class="col-md-4 col-sm-4">
                            <span> @Html.DropDownList("Month", Enumerable.Range(01, 12).Select(i => new SelectListItem { Value = i.ToString(), Text = i.ToString() }), "MM")</span>

                        </div>
                        <div class="col-md-4 col-sm-4">
                            <span> @Html.DropDownList("Date", Enumerable.Range(01, 31).Select(i => new SelectListItem { Value = i.ToString(), Text = i.ToString() }), "dd")</span>
                        </div>
                        <div class="col-md-4 col-sm-4">
                            <span>  @Html.DropDownList("Year", Enumerable.Range(year, 125).Select(i => new SelectListItem { Value = i.ToString(), Text = i.ToString() }), "yyyy")</span>
                        </div>
                    </div>
                    <span class="alert-danger" id="Error-date" style="display:none">Please select date.</span>
                </div>
                <div class="col-md-4">
                    <button id="btnSearch" class="button" name="button" value="Submit">Search</button>
                    <span class="alert-danger" id="validateForm" style="display:none">Please choose particular date </span>
                </div>
            </div>*@
        <div class="row top-buffer"></div>
        <div class="row top-buffer"></div>
        <div class="table-responsive" id="tab">
            @Html.Grid(Model).Columns(columns =>
       {
           columns.Add(m => m.FirstName)
                .Encoded(false)
                .Sanitized(false)
                .Sortable(true)
                .RenderValueAs(m => Html.ActionLink(m.FirstName, "DonorInfo", "Vendor", new { donorId = m.DonorId, donorTestInfoId = m.DonorTestInfoId }, null))
                .Titled("First Name");
           columns.Add(m => m.LastName).Sortable(true).Titled("Last Name");
           columns.Add(m => m.StrTestType).Titled("Test Type");
           columns.Add(m => m.StrFormType).Titled("Form Type");

       }).WithPaging(20)
        </div>
        <div class="row top-buffer"></div>
        <div class="row top-buffer"></div>
        <div class="row top-buffer"></div>
        <div class="row top-buffer"></div>
    </div>
    <div class="row top-buffer">
        <input type="hidden" name="hidSearchValue" id="hidSearchValue" value="0" />
        <input type="hidden" name="hidSearchKey" id="hidSearchKey" value="0" />
    </div>
    <div class="row top-buffer"></div>
}
}
