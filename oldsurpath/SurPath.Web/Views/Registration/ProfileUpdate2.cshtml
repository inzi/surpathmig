@model SurPathWeb.Models.DonorProfileDataModel
@using SurPath.Enum
@using SurPath.Entity
@{
    ViewBag.Title = "ProfileUpdate";
    Layout = "~/Views/Shared/_LayoutRegistration.cshtml";
    int year = 1950;
    int dobyear = Convert.ToInt32(DateTime.Now.Year) - year + 1;
}

@section PageScript
{
    <link href='@Url.Content("~/Content/themes/base/datepicker.css")' rel="stylesheet" type="text/css" />
    <script src='@Url.Content("~/Scripts/bootstrap-datepicker.js")'></script>
    <script src='@Url.Content("~/Scripts/jquery.maskedinput.min.js")'></script>

    <script type="text/javascript">
        $(function () {
            if ("@ViewBag.ServerErr" != "") {
                $("#divServerErr").show().find("div").html("@ViewBag.ServerErr");
            }

            if ("@ViewBag.SSNErr" != "") {
                $("#spnError").show();
            }
            else {
                $("#spnError").hide();
            }

            if ("@ViewBag.DOBERR" != "") {
                $("#lblDateError").show();
            }
            else {
                $("#lblDateError").hide();
            }

            $("#" + "@Model.Gender").click();
            $("[name='Suffix']").val("@Model.Suffix");
            $("[name='State']").val("@Model.State");

            $("#SSN").mask("999-99-9999");
            $("#Phone1").mask("(999) 999-9999");
            $("#Phone2").mask("(999) 999-9999");

            // PIDType Masks
                @{
                    foreach (int iPidType in Enum.GetValues(typeof(PidTypes)))
                    {
                        string __cls = "pidtype-" + iPidType.ToString();

                        PidTypes _p = ((PidTypes)iPidType);
                        string _jq = string.Empty;
                        switch (_p)
                        {
                            case PidTypes.SSN:
                                    _jq = "            $(\"." + __cls + "\").mask(\"999-99-9999\");";
                            break;


                        }
                        @Html.Raw(_jq);

                    }

                }
            function pidHidErr() {
                $('.pidrequired').each(function (i, obj) {
                    //test

                });
            }

            function pidValidate() {
                // pidrequired
                $('.pidrequired').each(function (i, obj) {
                    var _r = IsRequired(obj);
                    console.log(_r);
                });

                return false;
            }

            $("#SSN").focus();

            $("form :radio").click(function () {
                $(this).siblings(".alert-danger").hide();
                            });

            $("#ZipCode").keypress(function (e) {
                                if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
                    $("#ZipCode").siblings("#error").hide();
                                    return false;
                                }
                            });

            $("#submit").click(function () {
                $("#lblDateError").hide();
                $("#DonorDOBDate").css('border', '');
                $("#DonorDOBMonth").css('border', '');
                $("#DonorDOBYear").css('border', '');

                                var e = $("form sup").parent().next(),
                status = true;

                                e.keydown(function () {
                                    ClearBorder(this.id);
                                });

                                if ((($("#DonorDOBDate").val() == "") || ($("#DonorDOBMonth").val() == "") || ($("#DonorDOBYear").val() == ""))) {
                                    if (($("#DonorDOBDate").val() == ""))
                        $("#DonorDOBDate").css("border-color", "red");

                                    if ($("#DonorDOBMonth").val() == "")
                        $("#DonorDOBMonth").css("border-color", "red");

                                    if ($("#DonorDOBYear").val() == "")
                        $("#DonorDOBYear").css("border-color", "red");

                    $("#lblDateError").show();
                                    status = false;
                                }

                                if (!IsRequired(e.map(function () { return this.id }).get().join(','))) {
                    $("#ZipCode").siblings("#error").hide();
                                    status = false;
                                }
                else if ($("#ZipCode").val().length != 5) {
                    $("#ZipCode").siblings("#error").show();
                    $("#ZipCode").val('');
                                    return false;
                                }

                                if (!$("#Female").is(":checked") && !$("#Male").is(":checked")) {
                                    status = false;
                    $("#Female").siblings(".alert-danger").show();
                }

                
                                if (status) {
                    $("#submit").css("display", "none");
                    $("#submitWait").css("display", "inline");
                                }
                                return status;

                            });

                        });
    </script>
}

@{using (Html.BeginForm(null, null, FormMethod.Post, new { name = "frm", id = "frm" }))
    {
        <div class="container">
            <div style="display:none" class="alert alert-danger" role="alert" id="divServerErr">
                <i class="fa fa-exclamation-triangle fa-1x"></i> @ViewBag.ServerErr
            </div>
            <div class="row">
                <div class="text-primary">
                    <h3> Your Profile </h3>
                </div>
            </div>

            <!-- action is the place to attach the server side file php or asp -->
            <div class="form-group">
                <div class="row">
                    <div class="col-md-4 col-sm-4">
                        <label>Email Address</label>
                        @Html.TextBoxFor(m => m.EmailID, new
                   {
                       autocomplete = "off",
                       @class = "form-control",
                       placeholder = "Enter your Email Address",
                       data_ErrorMsg = "Email Address can not be empty.",
                       //@readonly = ""
                   })
                    </div>
                </div>
                @{
                    string frameClass = "pidframeset";
                    if (Model.PidErrorMesages.Count() > 0)
                    {
                        frameClass = "pidframeset pidframesetErr";
                    }
                }
                <div class="@frameClass">
                    <label class="pidframesetlegend">Personal Identification Fields Instructions:</label>
                    <div class="row">
                        <div class="col-md-8 col-sm-8">
                            <label>
                                Please provide the same personal identification information when you fill out the Chain of Custody Form at the time of testing.
                            </label>
                            <label>
                                All fields with a red star are required. All other fields are optional and will only help with ensuring your test results get reported properly.
                            </label>
                            <label>
                                If you choose to provide different information here than on the Chain of Custody Form, at the time of testing, it may result in a delay in your results.
                            </label>
                        </div>
                    </div>
                    @{ int PidTypeSSN = (int)PidTypes.SSN;
                        if (Model.PIDTypeValues.Exists(p => p.PIDType == PidTypeSSN && p.required == true))
                        {
                            <div class="row">
                                <div class="col-md-8 col-sm-8">
                                    <label>Your SSN is required for this program.</label>
                                </div>
                            </div>
                        }
                    }
                    @foreach (string errMsg in Model.PidErrorMesages)
                    {
                        <div class="row">
                            <div class="col-md-4 col-sm-4">
                                <span class="alert-danger" style="display: inline">@errMsg</span>
                            </div>
                        </div>
                    }

                    @for (var p = 0; p < Model.PIDTypeValues.Count; p++)
                    {
                        string __cls = "pidtype-" + Model.PIDTypeValues[p].PIDType.ToString().Trim() + " ";
                        bool IsRequired = Model.PIDTypeValues[p].required == true;
                        if (IsRequired == true) { __cls += __cls + " pidrequired "; }
                        bool IsReadOnly = Model.PIDTypeValues[p].isReadOnly == true;
                        bool HasErr = !(string.IsNullOrEmpty(Model.PIDTypeValues[p].Err));
                        string dispErr = "none";
                        if (HasErr == true) { dispErr = "inline"; }
                        if (Model.PIDTypeValues[p].PIDType == (int)PidTypes.SSN)
                        {

                            <div class="row">
                                <div class="col-md-6 col-sm-6">
                                    <label>
                                        SSN @if (IsRequired == true)
                                        {<sup>*</sup>}
                                    </label>
                                    @Html.TextBoxFor(m => m.PIDTypeValues[p].PIDValue, new {
                                   autocomplete = "off",
                                   @class = __cls + "form-control",
                                   placeholder = "Enter your SSN",
                                   data_ErrorMsg = "SSN can not be empty.",
                               })
                                    <span class="alert-danger" style="display: @dispErr;"></span>
                                    @Html.HiddenFor(m => m.PIDTypeValues[p].PIDType)
                                    @Html.HiddenFor(m => m.PIDTypeValues[p].required)

                                </div>
                            </div>
                        }
                        else if (Model.PIDTypeValues[p].PIDType == (int)PidTypes.DL)
                        {

                            <div class="row">
                                <div class="col-md-6 col-sm-6">
                                    <label>
                                        Driver's License @if (IsRequired == true)
                                        {<sup>*</sup>}
                                    </label>
                                    @Html.TextBoxFor(m => m.PIDTypeValues[p].PIDValue, new {
                                   autocomplete = "off",
                                   @class = __cls + "form-control",
                                   placeholder = "Enter your Driver's License",
                                   data_ErrorMsg = "Driver's License can not be empty.",
                               })
                                    <span class="alert-danger" style="display: @dispErr;"></span>
                                    @Html.HiddenFor(m => m.PIDTypeValues[p].PIDType)
                                    @Html.HiddenFor(m => m.PIDTypeValues[p].required)
                                </div>
                            </div>
                        }
                        else if (Model.PIDTypeValues[p].PIDType == (int)PidTypes.Passport)
                        {

                            <div class="row">
                                <div class="col-md-6 col-sm-6">
                                    <label>
                                        Passport ID @if (IsRequired == true)
                                        {<sup>*</sup>}
                                    </label>
                                    @Html.TextBoxFor(m => m.PIDTypeValues[p].PIDValue, new {
                                   autocomplete = "off",
                                   @class = __cls + "form-control pid_passport",
                                   placeholder = "Enter your Passport Number",
                                   data_ErrorMsg = "Passport Number can not be empty.",
                               })
                                    <span class="alert-danger" style="display: @dispErr;"></span>
                                    @Html.HiddenFor(m => m.PIDTypeValues[p].PIDType)
                                    @Html.HiddenFor(m => m.PIDTypeValues[p].required)

                                </div>
                            </div>
                        }
                        else if (Model.PIDTypeValues[p].PIDType == (int)PidTypes.StudentID)
                        {

                            <div class="row">
                                <div class="col-md-6 col-sm-6">
                                    <label>
                                        Student ID @if (IsRequired == true)
                                        {<sup>*</sup>}
                                    </label>
                                    @Html.TextBoxFor(m => m.PIDTypeValues[p].PIDValue, new {
                                   autocomplete = "off",
                                   @class = __cls + "form-control",
                                   placeholder = "Enter your Student ID",
                                   data_ErrorMsg = "Student ID can not be empty.",
                               })
                                    <span class="alert-danger" style="display: @dispErr;"></span>
                                    @Html.HiddenFor(m => m.PIDTypeValues[p].PIDType)
                                    @Html.HiddenFor(m => m.PIDTypeValues[p].required)

                                </div>
                            </div>
                        }

                        else if (Model.PIDTypeValues[p].PIDType == (int)PidTypes.MCEID)
                        {
                            var _readonlyval = "false";
                           // if (IsReadOnly == true) { _readonlyval = "true"; }
                            var _csshidden = string.Empty;
                            if (ViewBag.IntegrationPidType != (int)PidTypes.MCEID)
                            {
                                _csshidden = " hidden";
                            }

                            <div class="row">
                                <div class="col-md-6 col-sm-6 @_csshidden">
                                    <label>
                                        Integration ID @if (IsRequired == true)
                                        {<sup>*</sup>}
                                    </label>
                                    @{

                                        if (IsReadOnly == true)
                                        {
                                            // ro version
                                            @Html.TextBoxFor(m => m.PIDTypeValues[p].PIDValue, new {
                                                                             autocomplete = "off",
                                                                             @class = __cls + "form-control",
                                                                             placeholder = "",
                                                                             data_ErrorMsg = "Integration ID can not be empty.",
                                                                             @value = Model.PIDTypeValues[p].PIDValue.ToString(),
                                                                                  @readonly = "trye"
                                                                         })
                                        }
                                        else
                                        {
                                            //editable
                                            @Html.TextBoxFor(m => m.PIDTypeValues[p].PIDValue, new {
                                                                              autocomplete = "off",
                                                                              @class = __cls + "form-control",
                                                                              placeholder = "",
                                                                              data_ErrorMsg = "Integration ID can not be empty.",
                                                                              @value = Model.PIDTypeValues[p].PIDValue.ToString()
                                                                          })
                                        }

                                    }

                                    <span class="alert-danger" style="display: @dispErr;"></span>
                                    @Html.HiddenFor(m => m.PIDTypeValues[p].PIDType)
                                    @Html.HiddenFor(m => m.PIDTypeValues[p].required)
                                </div>
                            </div>
                        }
                        else if (Model.PIDTypeValues[p].PIDType == (int)PidTypes.PCID)
                        {
                            var _readonlyval = "false";
                            if (IsReadOnly == true) { _readonlyval = "true"; }
                            var _csshidden = string.Empty;
                            if (ViewBag.IntegrationPidType != (int)PidTypes.PCID)
                            {
                                _csshidden = " hidden";
                            }

                            <div class="row">
                                <div class="col-md-6 col-sm-6 @_csshidden">
                                    <label>
                                        Integration ID @if (IsRequired == true)
                                        {<sup>*</sup>}
                                    </label>
                                    @{

                                        if (IsReadOnly == true)
                                        {
                                            // ro version
                                            @Html.TextBoxFor(m => m.PIDTypeValues[p].PIDValue, new {
                                                                             autocomplete = "off",
                                                                             @class = __cls + "form-control",
                                                                             placeholder = "",
                                                                             data_ErrorMsg = "Integration ID can not be empty.",
                                                                             @value = Model.PIDTypeValues[p].PIDValue.ToString(),
                                                                                  @readonly = "trye"
                                                                         })
                                        }
                                        else
                                        {
                                            //editable
                                            @Html.TextBoxFor(m => m.PIDTypeValues[p].PIDValue, new {
                                                                              autocomplete = "off",
                                                                              @class = __cls + "form-control",
                                                                              placeholder = "",
                                                                              data_ErrorMsg = "Integration ID can not be empty.",
                                                                              @value = Model.PIDTypeValues[p].PIDValue.ToString()
                                                                          })
                                        }

                                    }
                                    <span class="alert-danger" style="display: @dispErr;"></span>
                                    @Html.HiddenFor(m => m.PIDTypeValues[p].PIDType)
                                    @Html.HiddenFor(m => m.PIDTypeValues[p].required)
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="row" visibility="hidden" style="display: none">
                                @Html.HiddenFor(m => m.PIDTypeValues[p].PIDValue)
                                <span class="alert-danger" style="display: @dispErr;"></span>
                                @Html.HiddenFor(m => m.PIDTypeValues[p].PIDType)
                                @Html.HiddenFor(m => m.PIDTypeValues[p].required)
                            </div>
                        }

                    }
                </div>



                <div class="row">
                    <div class="col-md-4 col-sm-4">
                        <label>First Name<sup>*</sup></label>
                        @Html.TextBoxFor(m => m.FirstName, new
                    {
                        autocomplete = "off",
                        @class = "form-control",
                        placeholder = "Enter your First Name",
                        data_ErrorMsg = "First Name can not be empty",
                    })
                        <span class="alert-danger" style="display: none"></span>
                    </div>
                    <div class="col-md-4 col-sm-4">
                        <label>Middle Initial</label>
                        @Html.TextBoxFor(m => m.MiddleInitial, new
                    {
                        autocomplete = "off",
                        @class = "form-control",
                        placeholder = "Enter your Middle Initial",
                    })
                    </div>
                    <div class="col-md-4 col-sm-4">
                        <label>Last Name<sup>*</sup></label>
                        @Html.TextBoxFor(m => m.LastName, new
                    {
                        autocomplete = "off",
                        @class = "form-control",
                        placeholder = "Enter your Last Name",
                        data_ErrorMsg = "Last Name can not be empty",
                    })
                        <span class="alert-danger" style="display: none"></span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 col-sm-4">
                        <label>Suffix</label>
                        <select class="form-control" name="Suffix" id="Suffix" value="@Model.Suffix">
                            <option value="">Select Suffix  </option>
                            <option value="Sr"> Sr. </option>
                            <option value="Jr"> Jr. </option>
                            <option value="II"> II </option>
                            <option value="III"> III </option>
                            <option value="IV"> IV </option>
                            <option value="V"> V </option>
                        </select>
                    </div>
                    <div id="DOB">
                        <div class="col-md-1 col-sm-1">
                            <label>D.O.B<sup>*</sup></label>
                            <span> @Html.DropDownListFor(m => m.DonorDOBMonth, Enumerable.Range(01, 12).Select(i => new SelectListItem { Value = i.ToString(), Text = i.ToString() }), "MM")</span>
                        </div>
                        <div class="col-md-1 col-sm-1">
                            <div class="row top-buffer"></div>
                            <div class="row top-buffer"></div>
                            <span> @Html.DropDownListFor(m => m.DonorDOBDate, Enumerable.Range(01, 31).Select(i => new SelectListItem { Value = i.ToString(), Text = i.ToString() }), "dd")</span>
                        </div>
                        <div class="col-md-2 col-sm-2">
                            <div class="row top-buffer"></div>
                            <div class="row top-buffer"></div>
                            <span>  @Html.DropDownListFor(m => m.DonorDOBYear, Enumerable.Range(year, dobyear).Select(i => new SelectListItem { Value = i.ToString(), Text = i.ToString() }), "yyyy")</span>
                            <span class="alert-danger" id="lblDateError" style="display:none">Invalid D.O.B</span>
                        </div>

                    </div>
                    <div class="col-md-4 col-sm-4">
                        <label>Gender<sup>*</sup></label>
                        <span class="clearfix"></span>
                        <input type="radio" name="Gender" id="Female" value="@Gender.Female">
                        <label style="padding-right: 30px;"> Female</label>
                        <input type="radio" id="Male" value="@Gender.Male" name="Gender">
                        <label> Male </label>
                        <span class="alert-danger" style="display: none">Gender must be selected</span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 col-sm-4">
                        <label>Address1<sup>*</sup></label>
                        @Html.TextBoxFor(m => m.Address1, new
                    {
                        autocomplete = "off",
                        @class = "form-control",
                        placeholder = "Enter your Address",
                        data_ErrorMsg = "Address1 can not be empty",
                    })
                        <span class="alert-danger" style="display: none"></span>
                    </div>
                    <div class="col-md-4 col-sm-4">
                        <label>Address2</label>
                        @Html.TextBoxFor(m => m.Address2, new
                    {
                        autocomplete = "off",
                        @class = "form-control",
                        placeholder = "Enter your Address",
                    })
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 col-sm-4">
                        <label>City<sup>*</sup></label>
                        @Html.TextBoxFor(m => m.City, new
                    {
                        autocomplete = "off",
                        @class = "form-control",
                        placeholder = "Enter your City",
                        data_ErrorMsg = "City can not be empty",
                    })
                        <span class="alert-danger" style="display: none"></span>
                    </div>
                    <div class="col-md-4 col-sm-4">
                        <label>State<sup>*</sup></label>
                        <select class="form-control" name="State" id="State" data-errormsg="State must be selected." value="@Model.State">
                            <option value="">Select State</option>
                            <option value="AK">Alaska</option>
                            <option value="AL">Alabama</option>
                            <option value="AR">Arkansas</option>
                            <option value="AZ">Arizona</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="IA">Iowa</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MD">Maryland</option>
                            <option value="ME">Maine</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MO">Missouri</option>
                            <option value="MS">Mississippi</option>
                            <option value="MT">Montana</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="NE">Nebraska</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NV">Nevada</option>
                            <option value="NY">New York</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VA">Virginia</option>
                            <option value="VT">Vermont</option>
                            <option value="WA">Washington</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WV">West Virginia</option>
                            <option value="WY">Wyoming</option>
                        </select>
                        <span class="alert-danger" style="display: none"></span>
                    </div>
                    <div class="col-md-4 col-sm-4">
                        <label>Zipcode<sup>*</sup></label>
                        @Html.TextBoxFor(m => m.ZipCode, new
                    {
                        @maxlength = "5",
                        autocomplete = "off",
                        @class = "form-control",
                        placeholder = "Enter your Zipcode",
                        data_ErrorMsg = "Zipcode can not be empty",
                    })
                        <span class="alert-danger" style="display: none"></span>
                        <span class="alert-danger" id="error" style="display:none">Enter correct Zipcode.</span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 col-sm-4">
                        <label>Phone1<sup>*</sup></label>
                        @Html.TextBoxFor(m => m.Phone1, new
                    {
                        autocomplete = "off",
                        @class = "form-control",
                        placeholder = "Enter your Phone",
                        data_ErrorMsg = "Phone1 can not be empty",
                    })
                        <span class="alert-danger" style="display: none"></span>
                    </div>
                    <div class="col-md-4 col-sm-4">
                        <label>Phone2</label>
                        @Html.TextBoxFor(m => m.Phone2, new
                    {
                        autocomplete = "off",
                        @class = "form-control",
                        placeholder = "Enter your Phone",
                        data_ErrorMsg = "Phone2 can not be empty",
                    })
                        <span class="alert-danger" style="display: none"></span>
                    </div>
                </div>
                <div class="row top-buffer"></div>
                <div class="clearfix"></div>
                <div class="row">
                    <div class="col-md-10 col-md-offset-5">
                        <button id="submit" name="button" value="Submit" class="btn btn-primary">Submit</button>
                        <button id="submitWait" name="button" value="submitWait" class="btn btn-primary" disabled="disabled" style="display: none;">Please Wait</button>
                    </div>
                </div>
                <br />
                <br />
            </div>
            <div class="row top-buffer"></div>
            <div class="row top-buffer"></div>

        </div>
    }
}
