# CLAUDE.md

@.KB/mandatory.md

## This File
This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This is an **enterprise SaaS migration project** for Surpath, a student compliance tracking system for schools. The repository contains three versions:

- **surpath112/**: Production system (ASP.NET Zero 11.4 MVC + jQuery)
- **surpath200/**: Target system (ASP.NET Zero Core + React SPA)
- **migration/**: Migration documentation and guides

## Asp.Net Zero
- **surpath112/**: Asp.Net zero version 11 - MVC Jquery
- **surpath200/**: Asp.Net zero version 15 - React

## Project Structure

```
I:\surpathmig\
├── surpath112/              # Source: MVC + jQuery (multi-page app)
│   ├── src/                 # Business implementation
│   ├── aspnetzeromvc11.4/   # ASP.NET Zero baseline reference (DO NOT MODIFY)
│   └── conventions/         # Established patterns and best practices
├── surpath200/              # Target: React SPA
│   ├── aspnet-core/         # Backend (.NET 8+)
│   └── react/               # Frontend (React + TypeScript)
└── migration/               # Migration guides and checklists
```

## Common Build Commands

### Surpath112 (MVC + jQuery)
```bash
# Build backend
cd surpath112
dotnet restore && dotnet build inzibackend.Web.sln

# Build frontend assets
cd src/inzibackend.Web.Mvc
yarn install
gulp buildDev        # Development with watch
gulp build           # Production minified

# Run application
cd src/inzibackend.Web.Mvc
dotnet run
# Navigate to: https://localhost:44302
```

### Surpath200 (React SPA)
```bash
# Build backend
cd surpath200/aspnet-core
dotnet restore && dotnet build inzibackend.Web.sln

# Build frontend
cd ../react
npm install
npm run dev          # Vite dev server with HMR
npm run build        # Production build
npm run typecheck    # TypeScript validation
npm run nswag        # Generate API client proxies
```

### Database Migrations
```bash
# Entity Framework migrations
cd surpath112/src/inzibackend.EntityFrameworkCore
dotnet ef database update

# Or from surpath200/aspnet-core
cd src/inzibackend.EntityFrameworkCore
dotnet ef database update
```

## Test Commands

```bash
# Run all tests
dotnet test

# Run specific test
dotnet test --filter "FullyQualifiedName=inzibackend.Tests.YourTestName"

# Test projects location
cd surpath112/test/inzibackend.Tests
```

## Architecture

### Backend (Both Versions - Clean Architecture)

**Layer Structure**:
1. **Core** - Domain entities and business rules (56+ compliance entities)
2. **Core.Shared** - Cross-cutting enums, constants, and helper classes
3. **Application.Shared** - Service interfaces and DTOs (268+ DTOs)
4. **Application** - Business logic and application services
5. **EntityFrameworkCore** - Data access with MySQL support
6. **Web.Core** - Shared web infrastructure (authentication, SignalR chat)
7. **Web.Host** - API endpoints (headless)
8. **Web.Mvc** (Surpath112 only) - Traditional MVC UI

**Key Patterns**:
- Repository Pattern for data access
- Unit of Work via ABP
- Dependency Injection (Castle Windsor)
- Domain-Driven Design principles
- Multi-tenancy with shared database + tenant discriminator
- AutoMapper for DTO ↔ Entity mapping

### Frontend

**Surpath112 (jQuery)**:
- Multi-page application (traditional MVC)
- jQuery + Bootstrap 5.1.1 + DataTables
- AJAX via `abp.services.app.serviceName.method()` proxies
- Controllers for page rendering, JavaScript for interactions
- Assets bundled via Gulp + bundles.json

**Surpath200 (React)**:
- Single Page Application (SPA)
- React 18.3.1 + TypeScript + Ant Design 5.26.7
- Redux Toolkit 2.8.2 for state management
- React Hook Form 7.62.0 for forms
- Vite 7.0.4 for fast bundling and HMR
- API client proxies generated by nswag

## Critical Rules

### Code Modifications
- **NEVER modify** files in `ABP7.3` or `ANZ11.4` folders (baseline references)
- **NEVER modify** files in `surpath112/aspnetzeromvc11.4/` (ASP.NET Zero template reference)
- Always read files before modifying them
- Prefer editing existing files over creating new ones

### ASP.NET Zero MVC Pattern (Surpath112)

**AJAX Flow**:
```javascript
// JavaScript calls app services via dynamic proxies
abp.services.app.yourServiceName.methodName({ param: value })
    .done(function(result) {
        // Handle success
    });
```

- App services in `*.Application` + `*.Application.Shared`
- ABP automatically exposes app services as Web API endpoints
- No manual ApiController needed for most CRUD operations
- MVC Controllers mainly for initial page rendering

### JavaScript Asset Management (Surpath112)
- JavaScript bundled dynamically via `gulpfile.js` and `bundles.json`
- Add new JS files to the proper area in `wwwroot/view-resources/Areas/App/Views/`
- Use unique, descriptive class names for DOM element targeting
- Reference elements in JS by class name for event binding

### Entity and DTO Pattern
- Domain entities in `inzibackend.Core/Surpath/`
- DTOs in `inzibackend.Application.Shared/Surpath/Dtos/`
- When editing an entity, update corresponding DTO as needed

### Localization
- Surpath112: Add strings to `inzibackend.xml` file
- Surpath200: Use i18next with React i18n patterns

## Domain Concepts

### Multi-Tenancy
- Each school is a tenant with isolated data
- Tenant context flows through all operations
- Host users manage system-wide configuration

### Cohort Users vs Users
- A `CohortUser` is a student in a cohort (always has a User)
- A `User` is not necessarily a `CohortUser` (could be staff)
- Some methods accept `userId` but find the `CohortUser` internally

### Compliance Tracking
- Core business domain with 56+ entities
- Requirements → Documents → Compliance Status
- Multi-level approvals and deadline tracking
- Audit trails for all changes

## Migration Context

### Current Phase
The project is actively migrating from Surpath112 (MVC/jQuery) to Surpath200 (React SPA).

### Migration Resources
- **Documentation**: `migration/` folder with 8 comprehensive guides
- **Module Checklist**: `migration/06-module-migration-checklist.md`
- **Key Patterns**: `migration/03-jquery-to-react-patterns.md`
- **Testing**: A/B comparison with production database copies

### Migration Patterns
- **DOM → State**: Replace jQuery DOM manipulation with React state
- **AJAX → Async/Await**: Maintain same service proxies, different syntax
- **Events → Handlers**: Replace `.on()` with onClick/onChange props
- **DataTables → React Tables**: Use Ant Design Table component
- **Modals → State**: Replace jQuery modals with React Modal component

## Security & Testing

### Test Credentials
- **Username**: claude@inzi.com
- **Password**: 25.Testing.25

### Database Structure
- Schema reference: `surpath112/sql/surpathv2schema.sql`
- MySQL database with EF Core migrations

## Key Documentation

### Surpath112
- Root: `surpath112/CLAUDE.md` - Build commands and guidelines
- `.cursorrules` - Development conventions and patterns
- `conventions/` folder - Best practices and architectural patterns
- Extensive CLAUDE.md files throughout all layers

### Surpath200
- `surpath200/README.md` - Project overview
- `surpath200/react/` - React SPA frontend

### Migration
- `migration/00-migration-overview.md` - Master plan and timeline
- 7 additional guides covering all migration aspects

## Important Notes

- **Simplicity First**: Don't overcomplicate things (per user guidelines)
- **Form Submissions**: If a page has multiple forms, give each an id to ensure scripts target the correct form
- **Convention Over Code**: Check `conventions/` folder before implementing new patterns
- **Backend Compatibility**: Most backend code translates directly between versions
- **Focus Area**: Frontend conversion is the primary effort (backend is stable)
